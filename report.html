<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Response</title>

  <link href="full.min.css" rel="stylesheet" type="text/css" />
  <script src="daisyui.js"></script>

</head>

<body class="p-6">
  <div class="container mx-auto">
    <div class="card shadow-lg p-6 rounded-lg">

      <!-- images -->
      <div class="carousel carousel-center rounded-box" id="images">
        <div class="carousel-item">
          <img src="https://img.daisyui.com/images/stock/photo-1559703248-dcaaec9fab78.webp" alt="Pizza" />
        </div>
        <div class="carousel-item">
          <img src="https://img.daisyui.com/images/stock/photo-1565098772267-60af42b81ef2.webp" alt="Pizza" />
        </div>
        <div class="carousel-item">
          <img src="https://img.daisyui.com/images/stock/photo-1572635148818-ef6fd45eb394.webp" alt="Pizza" />
        </div>
        <div class="carousel-item">
          <img src="https://img.daisyui.com/images/stock/photo-1494253109108-2e30c049369b.webp" alt="Pizza" />
        </div>
        <div class="carousel-item">
          <img src="https://img.daisyui.com/images/stock/photo-1550258987-190a2d41a8ba.webp" alt="Pizza" />
        </div>
        <div class="carousel-item">
          <img src="https://img.daisyui.com/images/stock/photo-1559181567-c3190ca9959b.webp" alt="Pizza" />
        </div>
        <div class="carousel-item">
          <img src="https://img.daisyui.com/images/stock/photo-1601004890684-d8cbf643f5f2.webp" alt="Pizza" />
        </div>
      </div>

      <h2 class="text-4xl font-bold mb-4 mt-2" id="title"></h2>

      <div class="mb-4">
                <h3 class="text-1xl text-gray-500 font-semibold" id="description">
                  <div class="skeleton h-4 w-full mb-1"></div>
                  <div class="skeleton h-4 w-full mb-1"></div>
                  <div class="skeleton h-4 w-5/6"></div>
                </h3>
            </div>

            <!-- sources -->
      <div class="mb-4">
        <!-- show favicons of the sources and when clicked axpand and show the link -->
         <div class="inline-flex space-x-2" id="sourceIcons">
          <img src="https://www.google.com/s2/favicons?domain=www.google.com" alt="Google" class="w-6 h-6 rounded-full" />
          <img src="https://www.google.com/s2/favicons?domain=www.google.com" alt="Google" class="w-6 h-6 rounded-full" />
          <img src="https://www.google.com/s2/favicons?domain=www.google.com" alt="Google" class="w-6 h-6 rounded-full" />
          <img src="https://www.google.com/s2/favicons?domain=www.google.com" alt="Google" class="w-6 h-6 rounded-full" />
          <img src="https://www.google.com/s2/favicons?domain=www.google.com" alt="Google" class="w-6 h-6 rounded-full" />

          <!-- arrow button -->
          <button class="btn btn-ghost btn-sm" id="expandSources">Show sources</button>
        </div>
      </div>

        <!-- expanded links, show as smal containers with title; use a carousel -->
        <div class="carousel carousel-center rounded-box mb-4 hidden" id="sources">
          <div class="carousel-item bg-gray-900 p-4 rounded-lg w-48 mx-2">
            <div class="flex flex-col space-y-2">
              <h4 class="font-semibold">Google is a search engine</h4>
              <a href="https://www.google.com" target="_blank" class="text-blue-500 inline-flex"><img src="https://www.google.com/s2/favicons?domain=www.google.com" alt="Google" class="w-5 h-5 rounded-full mr-2" /> google.com</a>
            </div>
          </div>
          <div class="carousel-item bg-gray-900 p-4 rounded-lg w-48 mx-2">
            <div class="flex flex-col space-y-2">
              <h4 class="font-semibold">Google is a search engine</h4>
              <a href="https://www.google.com" target="_blank" class="text-blue-500 inline-flex"><img src="https://www.google.com/s2/favicons?domain=www.google.com" alt="Google" class="w-5 h-5 rounded-full mr-2" /> google.com</a>
            </div>
          </div>
          <div class="carousel-item bg-gray-900 p-4 rounded-lg w-48 mx-2">
            <div class="flex flex-col space-y-2">
              <h4 class="font-semibold">Google is a search engine</h4>
              <a href="https://www.google.com" target="_blank" class="text-blue-500 inline-flex"><img src="https://www.google.com/s2/favicons?domain=www.google.com" alt="Google" class="w-5 h-5 rounded-full mr-2" /> google.com</a>
            </div>
          </div>
      </div>

      <br>

      <!-- answers -->
      <div class="mb-4" id="answers">
        <!-- skeleton -->
        <div class="flex flex-col space-y-2 mb-5">
          <div class="skeleton h-4 w-1/3"></div>
          <div class="skeleton h-4 w-3/4"></div>
          <div class="skeleton h-4 w-4/5"></div>
        </div>
        <div class="flex flex-col space-y-2 mb-5">
          <div class="skeleton h-4 w-1/3"></div>
          <div class="skeleton h-4 w-3/4"></div>
          <div class="skeleton h-4 w-4/5"></div>
        </div>
        <div class="flex flex-col space-y-2 mb-5">
          <div class="skeleton h-4 w-1/3"></div>
          <div class="skeleton h-4 w-3/4"></div>
          <div class="skeleton h-4 w-4/5"></div>
        </div>
      </div>

      <br>

      <div class="mb-4" id="sections">

        <div class="flex flex-col space-y-2 mb-5">
          <div class="skeleton h-4 w-1/2"></div>
          <div class="skeleton h-4 w-5/6"></div>
          <div class="skeleton h-4 w-full"></div>
          <div class="skeleton h-4 w-full"></div>
        </div>
        <div class="flex flex-col space-y-2 mb-5">
          <div class="skeleton h-4 w-1/2"></div>
          <div class="skeleton h-4 w-5/6"></div>
          <div class="skeleton h-4 w-full"></div>
          <div class="skeleton h-4 w-full"></div>
        </div>
        <div class="flex flex-col space-y-2 mb-5">
          <div class="skeleton h-4 w-1/2"></div>
          <div class="skeleton h-4 w-5/6"></div>
          <div class="skeleton h-4 w-full"></div>
          <div class="skeleton h-4 w-full"></div>
        </div>
        <div class="flex flex-col space-y-2 mb-5">
          <div class="skeleton h-4 w-1/2"></div>
          <div class="skeleton h-4 w-5/6"></div>
          <div class="skeleton h-4 w-full"></div>
          <div class="skeleton h-4 w-full"></div>
        </div>
        <div class="flex flex-col space-y-2 mb-5">
          <div class="skeleton h-4 w-1/2"></div>
          <div class="skeleton h-4 w-5/6"></div>
          <div class="skeleton h-4 w-full"></div>
          <div class="skeleton h-4 w-full"></div>
        </div>

      </div>
    </div>
  </div>


  <script>
    const title = document.getElementById('title');
    const description = document.getElementById('description');
    const images = document.getElementById('images');
    const content = document.getElementById('sections');
    const answers = document.getElementById('answers');

    const emojis = {
  ":bowtie:": "&#x1F604;",
  ":smile:": "&#x1F604;",
  ":laughing:": "&#x1F606;",
  ":blush:": "&#x1F60A;",
  ":smiley:": "&#x1F603;",
  ":relaxed:": "&#x263A;",
  ":smirk:": "&#x1F60F;",
  ":heart_eyes:": "&#x1F60D;",
  ":kissing_heart:": "&#x1F618;",
  ":kissing_closed_eyes:": "&#x1F61A;",
  ":flushed:": "&#x1F633;",
  ":relieved:": "&#x1F625;",
  ":satisfied:": "&#x1F606;",
  ":grin:": "&#x1F601;",
  ":wink:": "&#x1F609;",
  ":stuck_out_tongue_winking_eye:": "&#x1F61C;",
  ":stuck_out_tongue_closed_eyes:": "&#x1F61D;",
  ":grinning:": "&#x1F600;",
  ":kissing:": "&#x1F617;",
  ":kissing_smiling_eyes:": "&#x1F619;",
  ":stuck_out_tongue:": "&#x1F61B;",
  ":sleeping:": "&#x1F634;",
  ":worried:": "&#x1F61F;",
  ":frowning:": "&#x1F626;",
  ":anguished:": "&#x1F627;",
  ":open_mouth:": "&#x1F62E;",
  ":grimacing:": "&#x1F62C;",
  ":confused:": "&#x1F615;",
  ":hushed:": "&#x1F62F;",
  ":expressionless:": "&#x1F611;",
  ":unamused:": "&#x1F612;",
  ":sweat_smile:": "&#x1F605;",
  ":sweat:": "&#x1F613;",
  ":disappointed_relieved:": "&#x1F625;",
  ":weary:": "&#x1F629;",
  ":pensive:": "&#x1F614;",
  ":disappointed:": "&#x1F61E;",
  ":confounded:": "&#x1F616;",
  ":fearful:": "&#x1F628;",
  ":cold_sweat:": "&#x1F630;",
  ":persevere:": "&#x1F623;",
  ":cry:": "&#x1F622;",
  ":sob:": "&#x1F62D;",
  ":joy:": "&#x1F602;",
  ":astonished:": "&#x1F632;",
  ":scream:": "&#x1F631;",
  ":neckbeard:": "&#x1F42B;",
  ":tired_face:": "&#x1F62B;",
  ":angry:": "&#x1F620;",
  ":rage:": "&#x1F621;",
  ":triumph:": "&#x1F624;",
  ":sleepy:": "&#x1F62A;",
  ":yum:": "&#x1F60B;",
  ":mask:": "&#x1F637;",
  ":sunglasses:": "&#x1F60E;",
  ":dizzy_face:": "&#x1F635;",
  ":imp:": "&#x1F608;",
  ":smiling_imp:": "&#x1F607;",
  ":neutral_face:": "&#x1F610;",
  ":no_mouth:": "&#x1F636;",
  ":innocent:": "&#x1F607;",
  ":alien:": "&#x1F47D;",
  ":yellow_heart:": "&#x1F49B;",
  ":blue_heart:": "&#x1F499;",
  ":purple_heart:": "&#x1F49C;",
  ":heart:": "&#x2764;",
  ":green_heart:": "&#x1F49A;",
  ":broken_heart:": "&#x1F494;",
  ":heartbeat:": "&#x1F493;",
  ":heartpulse:": "&#x1F497;",
  ":two_hearts:": "&#x1F495;",
  ":revolving_hearts:": "&#x1F49E;",
  ":cupid:": "&#x1F498;",
  ":sparkling_heart:": "&#x1F496;",
  ":sparkles:": "&#x2728;",
  ":star:": "&#x2B50;",
  ":star2:": "&#x1F31F;",
  ":dizzy:": "&#x1F4AB;",
  ":boom:": "&#x1F4A5;",
  ":collision:": "&#x1F4A5;",
  ":anger:": "&#x1F4A2;",
  ":exclamation:": "&#x2757;",
  ":question:": "&#x2753;",
  ":grey_exclamation:": "&#x2755;",
  ":grey_question:": "&#x2754;",
  ":zzz:": "&#x1F4A4;",
  ":dash:": "&#x1F4A8;",
  ":sweat_drops:": "&#x1F4A6;",
  ":notes:": "&#x1F3B6;",
  ":musical_note:": "&#x1F3B5;",
  ":fire:": "&#x1F525;",
  ":hankey:": "&#x1F4A9;",
  ":poop:": "&#x1F4A9;",
  ":shit:": "&#x1F4A9;",
  ":+1:": "&#x1F44D;",
  ":thumbsup:": "&#x1F44D;",
  ":-1:": "&#x1F44E;",
  ":thumbsdown:": "&#x1F44E;",
  ":ok_hand:": "&#x1F44C;",
  ":punch:": "&#x1F44A;",
  ":facepunch:": "&#x1F44A;",
  ":fist:": "&#x270A;",
  ":v:": "&#x270C;",
  ":wave:": "&#x1F44B;",
  ":hand:": "&#x270B;",
  ":raised_hand:": "&#x270B;",
  ":open_hands:": "&#x1F450;",
  ":point_up:": "&#x261D;",
  ":point_down:": "&#x1F447;",
  ":point_left:": "&#x1F448;",
  ":point_right:": "&#x1F449;",
  ":raised_hands:": "&#x1F64C;",
  ":pray:": "&#x1F64F;",
  ":point_up_2:": "&#x1F446;",
  ":clap:": "&#x1F44F;",
  ":muscle:": "&#x1F4AA;",
  ":metal:": "&#x1F918;",
  ":fu:": "&#x1F595;",
  ":walking:": "&#x1F6B6;",
  ":runner:": "&#x1F3C3;",
  ":running:": "&#x1F3C3;",
  ":couple:": "&#x1F46B;",
  ":family:": "&#x1F46A;",
  ":two_men_holding_hands:": "&#x1F46C;",
  ":two_women_holding_hands:": "&#x1F46D;",
  ":dancer:": "&#x1F483;",
  ":dancers:": "&#x1F46F;",
  ":ok_woman:": "&#x1F646;",
  ":no_good:": "&#x1F645;",
  ":information_desk_person:": "&#x1F481;",
  ":raising_hand:": "&#x1F64B;",
  ":bride_with_veil:": "&#x1F470;",
  ":person_with_pouting_face:": "&#x1F64E;",
  ":person_frowning:": "&#x1F64D;",
  ":bow:": "&#x1F647;",
  ":couplekiss:": "&#x1F48F;",
  ":couple_with_heart:": "&#x1F491;",
  ":massage:": "&#x1F486;",
  ":haircut:": "&#x1F487;",
  ":nail_care:": "&#x1F485;",
  ":boy:": "&#x1F466;",
  ":girl:": "&#x1F467;",
  ":woman:": "&#x1F469;",
  ":man:": "&#x1F468;",
  ":baby:": "&#x1F476;",
  ":older_woman:": "&#x1F475;",
  ":older_man:": "&#x1F474;",
  ":person_with_blond_hair:": "&#x1F471;",
  ":man_with_gua_pi_mao:": "&#x1F472;",
  ":man_with_turban:": "&#x1F473;",
  ":construction_worker:": "&#x1F477;",
  ":cop:": "&#x1F46E;",
  ":angel:": "&#x1F47C;",
  ":princess:": "&#x1F478;",
  ":smiley_cat:": "&#x1F63A;",
  ":smile_cat:": "&#x1F638;",
  ":heart_eyes_cat:": "&#x1F63B;",
  ":kissing_cat:": "&#x1F63D;",
  ":smirk_cat:": "&#x1F63C;",
  ":scream_cat:": "&#x1F640;",
  ":crying_cat_face:": "&#x1F63F;",
  ":joy_cat:": "&#x1F639;",
  ":pouting_cat:": "&#x1F63E;"
};


    function getData() {
      const url = './data.json';
      fetch(url)
        .then(response => response.json())
        .then(data => {
          console.log(data);
          main(data);
        })
        .catch(error => console.error(error));

    }

    function renderAnswer(data) {
        // if data.answer is a string
     if (typeof data.answer === 'object') {
        // if data.answer is an object

        // hide the description
        description.style.display = 'none';

      answers.innerHTML = Object.entries(data.answer).map(([key, value]) => {
        // search in value for emojis using regex, like :smile:
        const regex = /:[a-z_]+:/g;
        // search for emojis in the value
        try {
          value = value.replace(regex, (match) => {
            return emojis[match] || match;
          });
        } catch (error) {
          console.error(error);
        }

        return `
                <div class="mb-2">
                    <h4 class="text-lg font-semibold">${key}</h4>
                    <p class="text-gray-500">${value}</p>
                </div>
            `;
      }).join('');
    } else  if (typeof data.answer === 'string') {
      console.log(data.answer);
        description.innerText = data.answer;

        // hide the answers
        answers.style.display = 'none';
    }
    }

    function renderSections(data) {
      
      sections.innerHTML = data.sections.map((section, index) => {
        return `
                <div class="mb-2">
                    <h4 class="text-lg font-semibold">${data.headings[index]}</h4>
                    <ul class="list-disc list-inside text-gray-500">
                        ${Object.entries(section).map(([key, value]) => {
          return `<li><strong>${key}</strong>: ${value}</li>`;
        }).join('')}
                    </ul>
                </div>
            `;
      }).join('');
    }

    function renderSources(data) {
      // render the sourceIcons
      sourceIcons.innerHTML = data.sources.map((source) => {
        return `<img src="https://www.google.com/s2/favicons?domain=${source.url}" alt="${source.url}" class="w-6 h-6 rounded-full" />`;
      }).join('');
      // add show sources button
      sourceIcons.innerHTML += `<button class="btn btn-ghost btn-sm" onclick="document.getElementById('sources').classList.toggle('hidden')">Show sources</button>`;	

      // render the sources
      sources.innerHTML = data.sources.map((source) => {
        let host = new URL(source.url).host;
        // remove www from the host
        host = host.replace('www.', '');
        return `
                <div class="carousel-item bg-gray-900 p-4 rounded-lg w-48 mx-1">
                    <div class="flex flex-col space-y-2">
                        <h4 class="font-semibold">${source.title}</h4>
                        <a href="${source.url}" target="_blank" class="text-blue-500 inline-flex"><img src="https://www.google.com/s2/favicons?domain=${source.url}" alt="${host}" class="w-5 h-5 rounded-full mr-2" /> ${host}</a>
                    </div>
                </div>
            `;
      }).join('');
    }

    function renderContent(data) {
      try {
        title.innerText = data.title;
      } catch (error) {
        console.error(error);
      }

      try {
        renderImages(data);
      } catch (error) {
        console.error(error);
      }
  
      try {
       renderAnswer(data);
      } catch (error) {
        console.error(error);
      }

      try {
        renderSections(data);
      } catch (error) {
        console.error(error);
      }

      try {
        renderSources(data);
      } catch (error) {
        console.error(error);
      }
    }

    function renderImages(data) {
      images.innerHTML = data.imageUrls.map((image) => {
        return `
                <div class="carousel-item h-80">
                    <img src="${image.image}" alt="${image.title}" onclick="window.open('${image.url}', '_blank')" title="${image.title}" height="100%" width="100%" onerror="this.parentElement.remove();" />
                </div>
            `;
      }).join('');

    }



    function main(data) {
      renderContent(data);
    }

    function init() {
      // get the q parameter from the url, e.g. ?q=apple
      const urlParams = new URLSearchParams(window.location.search);
      let q = urlParams.get('q');

      console.log(q);
      if (q) {
        // make each word in the query a title case
        q = q.split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
        title.innerText = q;
      }


      getData();
    }

    init();
  </script>

</body>

</html>